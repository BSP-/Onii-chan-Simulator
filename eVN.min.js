!function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){/**eVN - Everyone's Visual Novel (Development build)
	 * @see {@link https://github.com/bytesizedpacket/eVN}
	 * @fileOverview eVN core script
	 * @author Jacob Pedersen <jacob@bytesizedpacket.com> & Byte-Sized Packet <contact@bytesizedpacket.com>
	 * @copyright Byte-Sized Packet 2015
	 * @license {@link https://github.com/bytesizedpacket/eVN/blob/master/LICENSE | Attribution Assurance License (BSP edit)}
	 * @version: 0.0.1a Pre-development version */
"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),o=r(6),s=new o.Logger("eVN","0.1a",!0),c=function(){function e(){n(this,e),this.instances=[]}return a(e,[{key:"logger",get:function(){return s}}]),e}();t.Main=c,window.eVN?s["throw"]("`window.eVN` is already declared")():window.eVN=new c,document.addEventListener("DOMContentLoaded",function(){var e=Array.prototype.slice.call(document.getElementsByTagName("canvas")),t=!0,r=!1,n=void 0;try{for(var a,o=function(){var e=a.value;return(c=e.getAttribute("data-evn"))?(l=new XMLHttpRequest,l.open("GET",c,!0),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&new i.Novel(e,l.responseText,c)},void l.send()):{v:void 0}},s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var c,l,u=o();if("object"==typeof u)return u.v}}catch(h){r=!0,n=h}finally{try{!t&&s["return"]&&s["return"]()}finally{if(r)throw n}}}),setTimeout(function(){window.t=eVN.instances[0]},500)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(2),s=null,c=function(){function e(t,r){var a=this,i=arguments.length<=2||void 0===arguments[2]?"undefined":arguments[2];n(this,e),s=eVN.logger,this.file=i,this.canvas=t,this.context=t.getContext("2d"),this.images={},this.audio={},this.characters={},this.eVNML=this.parse_eVNML(r),this.visuals=new o.Visuals(this),this.cdata={background:null,characters:[],collection:"start",collectionIndex:0,dialogue:"",dialogueLines:[],mouseX:-1,mouseY:-1,jobs:[],startLine:0,speaker:""},this.canvas.className=this.canvas.className+" eVN-canvas",this.eVNML.options.textbox.image&&(this.images.textbox=new Image,this.images.textbox.src=this.eVNML.options.textbox.image),this.eVNML.options.textbox.speakerbox.image&&(this.images.speakerbox=new Image,this.images.speakerbox.src=this.eVNML.options.textbox.speakerbox.image),this.canvas.addEventListener("click",function(){return a.parseScene.call(a)}),this.canvas.addEventListener("mousemove",function(e){var t=e.target||e.srcElement,r=t.getBoundingClientRect(),n=r.width/t.width,i=r.height/t.height;a.cdata.mouseX=Math.round((e.clientX-r.left)/n),a.cdata.mouseY=Math.round((e.clientY-r.top)/i)});for(var c in this.eVNML.images)this.images[c]=new Image,this.images[c].src=this.eVNML.images[c];for(var c in this.eVNML.audio)this.audio[c]=new Audio,this.audio[c].src=this.eVNML.audio[c];for(var c in this.eVNML.characters){var l=this.eVNML.characters[c];this.characters[c]={name:l["first name"]||l.name,lname:l["last name"],color:l.color||l.colour,images:{}};var u=this.characters[c];for(var h in l.images)u.images[h]=l.images[h];u.cImage=u.images["default"]}this.parseScene(this.cdata.currentCollection,this.cdata.collectionIndex);var f=eVN.instances.push(this)-1;s.log("Created new eVN instance from file `"+this.file+"` under eVN.instances["+f+"]")()}return a(e,[{key:"parse_eVNML",value:function(e){var t=r(5),n=e,a=t;try{n=JSON.parse(e);var i=function s(e,t){var r=t;for(var n in e)n in t?e[n].constructor===Object&&t[n].constructor===Object?r[n]=s(e[n],t[n]):e[n].constructor!==t[n].constructor?(eVN.logger.warn('Possible type mismatch on property "'+n+'" while parsing eVNML.'),r[n]=e[n]):r[n]=e[n]:r[n]=e[n];return r};a=i(n,t)}catch(o){eVN.logger["throw"](o)}return a}},{key:"parseScene",value:function(e,t){var r=this.cdata,n=this.eVNML,a=n.options.textbox;if(e=e||r.collection,t="undefined"!=typeof t?t:r.collectionIndex,r.startLine+a.lines<r.dialogueLines.length)return r.startLine+=a.lines;var o=this.eVNML.scenes[e][t];if(r.collection=e,r.collectionIndex=t+1,o||eVN.logger["throw"]('Undefined scene "'+e+"["+t+']"! Did we run out of scenes?'),r.speakerColor=null,"string"==typeof o){var s=o.indexOf(": "),c=o.slice(0,s),l=o.slice(s+2),u=s<o.indexOf(" ")&&c in this.characters;o=u?["say",l,c]:["say",o]}switch(o[0].toLowerCase()){case"background":r.background=o[1];break;case"music":o[1]in this.audio&&this.audio[o[1]].play();break;case"say":var h=this.processVariables(o[1]);o[2]?(r.speaker=o[2],r.dialogue='"'+h+'"',r.speakerColor=o[3]||null):(r.speaker=null,r.dialogue=h);var f=a.maxWidth;return r.dialogueLines=this.visuals.text.split(this.context,r.dialogue,a.font.size,f),void(r.startLine=0);case"setmood":var g=-1,d=!0,v=!1,m=void 0;try{for(var p,y=r.characters[Symbol.iterator]();!(d=(p=y.next()).done);d=!0){var w=p.value;if(w.character===o[1]){g=i;break}}}catch(x){v=!0,m=x}finally{try{!d&&y["return"]&&y["return"]()}finally{if(v)throw m}}g>-1&&(r.characters[g].mood=o[2]||"default");break;case"hide":r.characters[o[1]]=null;break;case"show":var g=-1,b=!0,k=!1,N=void 0;try{for(var V,L=r.characters[Symbol.iterator]();!(b=(V=L.next()).done);b=!0){var w=V.value;if(w.character===o[1]){g=i;break}}}catch(x){k=!0,N=x}finally{try{!b&&L["return"]&&L["return"]()}finally{if(k)throw N}}if(g>-1){var M=r.characters[g];M={character:M.character,position:o[2]||M.position||"middle",mood:M.mood||"default",priority:o[4]||M.priority||1}}else r.characters.push({character:o[1],position:o[2]||"middle",mood:"default"});break;case"goto":case"jump":r.collection=o[1],r.collectionIndex=0;break;default:eVN.logger.warn('Unknown command "'+o[0]+'" at "'+e+"["+t+']"')}this.parseScene()}},{key:"processVariables",value:function(e){var t=e.indexOf("${"),r=e.indexOf("}",t),n="";if(-1!==t&&-1!==r){var a=e.slice(0,t),i=e.slice(t+2,r),o=e.slice(r+1);n=i;var s=i.split(".");this.cdata.characters.map(function(e){return e.character}).indexOf(s[0]);return s[0]in this.characters&&(n=this.characters[s[0]][s[1]]),n=a+n+o,-1!==n.indexOf("${")?this.processVariables(n):n}return e}},{key:"constructCharacter",value:function(e){var t=e.name;this.characters[t]={}}}]),e}();t.Novel=c},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(3),s=n(o),c=null,l=r(4),u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},h=function(){function e(t){var r=this;a(this,e),c=eVN.logger,this.novel=t,this.ctx=t.context,this.draw=l,this.text=s,u(function(e){return r.loop(e)})}return i(e,[{key:"loop",value:function(e){var t=this,r=this.novel,n=r.context,a=r.cdata,i=r.eVNML.options.textbox,o=a.background,s=null,c=r.characters;o?"#"===o[0]?s=o:o in r.images&&(s=r.images[o]):s=null,this.draw.background(n,s||"#FFF"),r.cdata.characters.sort(function(e,t){return e.priority-t.priority});var l=!0,h=!1,f=void 0;try{for(var g,d=a.characters[Symbol.iterator]();!(l=(g=d.next()).done);l=!0){var v=g.value,m=v.character,p=c[m].images[v.mood],y=r.images[p],w=null,x=n.canvas.height-y.height;switch(v.position.toLowerCase()){case"left":w=n.canvas.width/4-y.width/2;break;case"right":w=n.canvas.width/4*3-y.width/2;break;case"middle":default:w=n.canvas.width/2-y.width/2}n.drawImage(y,w,x,y.width,y.height)}}catch(b){h=!0,f=b}finally{try{!l&&d["return"]&&d["return"]()}finally{if(h)throw f}}this.draw.dialogueBox(n,i,r.images.textbox);var k=this.text.CSS_string(i.font.size,i.font.family,i.font.style,i.font.weight);n.fillStyle=i.font.color,n.textBaseline="top",n.font=k;var N=(a.dialogue||"",a.dialogueLines.slice(a.startLine).slice(0,i.lines));this.draw.dialogueText(n,N,i,i.lines);var V=a.speaker||"",L=a.speakerColor||i.font.color;a.speaker in r.characters&&(V=r.characters[a.speaker].name,L=r.characters[a.speaker].color),this.draw.speakerText(n,V,i.speakerbox,L),u(function(e){return t.loop(e)})}}]),e}();t.Visuals=h},function(e,t){"use strict";function r(e,t,r,n){var a=arguments.length<=4||void 0===arguments[4]?!0:arguments[4],i=arguments.length<=5||void 0===arguments[5]?[]:arguments[5];if(a=a!==!1,-1!==t.indexOf("\n")){var o=t.indexOf("\n"),s=t.slice(0,o),c=t.slice(o+1);return this.split(e,s,r,n).concat(this.split(e,c,r,n))}if(e.measureText(t).width<=n)return[t];var l=t.split(" "),u=l.length;if(a){var h=n/(r/2.5),f=t.indexOf(" ",h);u=t.slice(0,f).split(" ").length,u>l.length&&(u=l.length)}for(var g=u;g>=1;g--){var s=l.slice(0,g).join(" "),c=l.slice(g,l.length).join(" "),d=e.measureText(s).width;if(a&&n>d&&g===u)return this.split(e,t,r,n,!1);if(n>d)return i.push(s),c?i.concat(this.split(e,c,r,n)):i}return eVN.logger.warn('Unable to split word "'+l[0]+'".'),i.push(l.shift()),l.length>=1?i.concat(this.split(e,l.join(" "),r,n)):i}function n(){var e=arguments.length<=0||void 0===arguments[0]?18:arguments[0],t=arguments.length<=1||void 0===arguments[1]?"Comic Neue":arguments[1],r=arguments.length<=2||void 0===arguments[2]?"normal":arguments[2],n=arguments.length<=3||void 0===arguments[3]?"normal":arguments[3];return t="'"===t[0]?t:'"'===t[0]?t:"'"+t+"'",r+" "+n+" "+e+"px "+t}Object.defineProperty(t,"__esModule",{value:!0}),t.split=r,t.CSS_string=n},function(e,t){"use strict";t.background=function(e,t){var r=e,n=r;t instanceof Image?r.drawImage(t,0,0,n.canvas.width,n.canvas.height):(r.fillStyle=t,r.fillRect(0,0,n.canvas.width,n.canvas.height))},t.dialogueBox=function(e,t,r){var n=e,a=t;if(r){var i=0,o=n.canvas.height-r.height,s=r.width,c=r.height;n.drawImage(r,i,o,s,c)}else{var i=0,o=n.canvas.height-a.speakerbox.bottom-5,s=n.canvas.width,c=n.canvas.height;n.fillStyle="rgba(0, 0, 0, .35)",n.fillRect(i,o,s,c)}},t.speakerBox=function(e,t){var r=e,n=t,a=n.speakerbox,i=a.left,o=r.canvas.height-a.bottom-a.height,s=a.width,c=a.height;r.fillStyle=a.color||n.color,r.fillRect(i,o,s,c)},t.dialogueText=function(e,t,r,n){var a=e,i=r,o=i.lineHeight,s=i.maxWidth,c=i.left,l=a.canvas.height-i.bottom;n=n||3;for(var u=0,h=t.length;(h>n?n:h)>u;u++){var f=l+o*u;a.fillText(t[u],c,f,s)}},t.speakerText=function(e,t,r,n){var a=e,i=r,o=i.left,s=a.canvas.height-i.bottom,c=i.maxWidth||a.canvas.width-o;a.fillStyle=n||a.fillStyle,a.fillText(t,o,s,c)}},function(e,t){"use strict";e.exports={options:{textbox:{font:{size:"17",family:"Comic Neue",style:"normal",weight:"normal",color:"#EEE"},lines:3,lineHeight:"22",bottom:95,left:40,maxWidth:750,speakerbox:{left:25,bottom:130,maxWidth:150}}},audio:{},images:{},characters:{},scenes:{start:["No scenes defined!"]}}},function(e,t){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?"Unnamedlogger":arguments[0],r=arguments.length<=1||void 0===arguments[1]?"NaN":arguments[1],a=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];n(this,e),this.name=t,this.version=r,this.verbose=a,this.logName=this.name+" v"+this.version,this.logPrefix="["+this.logName+" INFO]",this.warnPrefix="["+this.logName+" WARN]",this.errPrefix="["+this.logName+" ERR]"}return a(e,[{key:"log",value:function(){for(var e,t=[this.logPrefix],n=arguments.length,a=Array(n),i=0;n>i;i++)a[i]=arguments[i];return a.length<1||!this.verbose?function(){}:(1===a.length&&"string"==typeof a[0]?t[0]+=" "+a[0]:t=[t[0]].concat(a),console&&console.log?(e=console.log).bind.apply(e,[console].concat(r(t))):void 0)}},{key:"warn",value:function(){for(var e,t=[this.warnPrefix],n=arguments.length,a=Array(n),i=0;n>i;i++)a[i]=arguments[i];return a.length<1?function(){}:(1===a.length&&"string"==typeof a[0]?t[0]+=" "+a[0]:t=[t[0]].concat(a),console&&console.warn?(e=console.warn).bind.apply(e,[console].concat(r(t))):void 0)}},{key:"throw",value:function(e,t){var r=this;void 0===e&&(e="UnknownError");var n;return e instanceof Error?n=e:(n=new Error(e),t&&(n.stack=t)),n.name=this.errPrefix+" "+n.name,function(){throw console&&console.error?(t&&console.error(r.errPrefix+" "+n.message),console.error(n.stack),r.logName+" halted"):n}}}]),e}();t.Logger=i}]);