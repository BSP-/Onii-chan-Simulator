!function(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){/**eVN - Everyone's Visual Novel (Development build)
	 * @see {@link https://github.com/bytesizedpacket/eVN}
	 * @fileOverview eVN core script
	 * @author Jacob Pedersen <jacob@bytesizedpacket.com> & Byte-Sized Packet <contact@bytesizedpacket.com>
	 * @copyright Byte-Sized Packet 2015
	 * @license {@link https://github.com/bytesizedpacket/eVN/blob/master/LICENSE | Attribution Assurance License (BSP edit)}
	 * @version: 0.0.1a Pre-development version */
"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),i=a(1),o=a(6),s=new o.Logger("eVN","0.1a",!0),c=function(){function e(){r(this,e),this.instances=[]}return n(e,[{key:"logger",get:function(){return s}}]),e}();t.Main=c,window.eVN?s["throw"]("`window.eVN` is already declared")():window.eVN=new c,document.addEventListener("DOMContentLoaded",function(){var e=Array.prototype.slice.call(document.getElementsByTagName("canvas")),t=!0,a=!1,r=void 0;try{for(var n,o=function(){var e=n.value;return(c=e.getAttribute("data-evn"))?(l=new XMLHttpRequest,l.open("GET",c,!0),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&new i.Novel(e,l.responseText,c)},void l.send()):{v:void 0}},s=e[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var c,l,h=o();if("object"==typeof h)return h.v}}catch(u){a=!0,r=u}finally{try{!t&&s["return"]&&s["return"]()}finally{if(a)throw r}}}),setTimeout(function(){window.t=eVN.instances[0]},500)},function(e,t,a){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),o=a(2),s=null,c=function(){function e(t,a){var n=this,i=arguments.length<=2||void 0===arguments[2]?"undefined":arguments[2];r(this,e),s=eVN.logger,this.file=i,this.canvas=t,this.context=t.getContext("2d"),this.images={},this.audio={},this.characters={},this.eVNML=this.parse_eVNML(a),this.visuals=new o(this),this.cdata={background:null,characters:[],collection:"start",collectionIndex:0,dialogue:"",dialogueLines:[],mouseX:-1,mouseY:-1,jobs:[],startLine:0,speaker:""},this.canvas.className=this.canvas.className+" eVN-canvas",this.eVNML.options.textbox.image&&(this.images.textbox=new Image,this.images.textbox.src=this.eVNML.options.textbox.image),this.eVNML.options.textbox.speakerbox.image&&(this.images.speakerbox=new Image,this.images.speakerbox.src=this.eVNML.options.textbox.speakerbox.image),this.canvas.addEventListener("click",function(){return n.parseScene.call(n)}),this.canvas.addEventListener("mousemove",function(e){var t=e.target||e.srcElement,a=t.getBoundingClientRect(),r=a.width/t.width,i=a.height/t.height;n.cdata.mouseX=Math.round((e.clientX-a.left)/r),n.cdata.mouseY=Math.round((e.clientY-a.top)/i)});for(var c in this.eVNML.images)this.images[c]=new Image,this.images[c].src=this.eVNML.images[c];for(var c in this.eVNML.audio)this.audio[c]=new Audio,this.audio[c].src=this.eVNML.audio[c];for(var c in this.eVNML.characters){var l=this.eVNML.characters[c];this.characters[c]={name:l["first name"]||l.name,lname:l["last name"],color:l.color||l.colour,images:{}};var h=this.characters[c];for(var u in l.images)h.images[u]=l.images[u];h.cImage=h.images["default"]}this.parseScene(this.cdata.currentCollection,this.cdata.collectionIndex);var f=eVN.instances.push(this)-1;s.log("Created new eVN instance from file `"+this.file+"` under eVN.instances["+f+"]")()}return n(e,[{key:"parse_eVNML",value:function(e){var t=a(5),r=e,n=t;try{r=JSON.parse(e);var i=function s(e,t){var a=t;for(var r in e)r in t?e[r].constructor===Object&&t[r].constructor===Object?a[r]=s(e[r],t[r]):e[r].constructor!==t[r].constructor?(eVN.logger.warn('Possible type mismatch on property "'+r+'" while parsing eVNML.'),a[r]=e[r]):a[r]=e[r]:a[r]=e[r];return a};n=i(r,t)}catch(o){eVN.logger["throw"](o)}return n}},{key:"parseScene",value:function(e,t){var a=this.cdata,r=this.eVNML,n=r.options.textbox;if(e=e||a.collection,t="undefined"!=typeof t?t:a.collectionIndex,a.startLine+n.lines<a.dialogueLines.length)return a.startLine+=n.lines;var o=this.eVNML.scenes[e][t];if(a.collection=e,a.collectionIndex=t+1,o||eVN.logger["throw"]('Undefined scene "'+e+"["+t+']"! Did we run out of scenes?'),a.speakerColor=null,"string"==typeof o){var s=o.indexOf(": "),c=o.slice(0,s),l=o.slice(s+2),h=s<o.indexOf(" ")&&c in this.characters;o=h?["say",l,c]:["say",o]}switch(o[0].toLowerCase()){case"background":a.background=o[1];break;case"music":o[1]in this.audio&&this.audio[o[1]].play();break;case"say":var u=this.processVariables(o[1]);o[2]?(a.speaker=o[2],a.dialogue='"'+u+'"',a.speakerColor=o[3]||null):(a.speaker=null,a.dialogue=u);var f=n.maxWidth;return a.dialogueLines=this.visuals.text.split(this.context,a.dialogue,n.font.size,f),void(a.startLine=0);case"setmood":var d=-1,g=!0,v=!1,m=void 0;try{for(var p,x=a.characters[Symbol.iterator]();!(g=(p=x.next()).done);g=!0){var w=p.value;if(w.character===o[1]){d=i;break}}}catch(y){v=!0,m=y}finally{try{!g&&x["return"]&&x["return"]()}finally{if(v)throw m}}d>-1&&(a.characters[d].mood=o[2]||"default");break;case"hide":a.characters[o[1]]=null;break;case"show":var d=-1,b=!0,k=!1,N=void 0;try{for(var L,V=a.characters[Symbol.iterator]();!(b=(L=V.next()).done);b=!0){var w=L.value;if(w.character===o[1]){d=i;break}}}catch(y){k=!0,N=y}finally{try{!b&&V["return"]&&V["return"]()}finally{if(k)throw N}}if(d>-1){var M=a.characters[d];M={character:M.character,position:o[2]||M.position||"middle",mood:M.mood||"default",priority:o[4]||M.priority||1}}else a.characters.push({character:o[1],position:o[2]||"middle",mood:"default"});break;case"goto":case"jump":a.collection=o[1],a.collectionIndex=0;break;default:eVN.logger.warn('Unknown command "'+o[0]+'" at "'+e+"["+t+']"')}this.parseScene()}},{key:"processVariables",value:function(e){var t=e.indexOf("${"),a=e.indexOf("}",t),r="";if(-1!==t&&-1!==a){var n=e.slice(0,t),i=e.slice(t+2,a),o=e.slice(a+1);r=i;var s=i.split(".");this.cdata.characters.map(function(e){return e.character}).indexOf(s[0]);return s[0]in this.characters&&(r=this.characters[s[0]][s[1]]),r=n+r+o,-1!==r.indexOf("${")?this.processVariables(r):r}return e}},{key:"constructCharacter",value:function(e){var t=e.name;this.characters[t]={}}}]),e}();t.Novel=c},function(e,t,a){"use strict";var r=a(3),n=a(4),i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout(e,1e3/60)};e.exports=function(e){this.novel=e,this.ctx=e.context;var t=this;i(function(e){t.loop.call(t,e)})},e.exports.prototype={draw:n,text:r,loop:function(e){var t=this.novel,a=t.context,r=a,n=t.cdata,o=t.eVNML,s=o.options.textbox,c=n.background,l=t.characters,h=t.cdata.characters;c&&"#"!==c[0]&&c in t.images&&(c=t.images[c]),this.draw.background(r,c||"#FFF"),h.sort(function(e,t){return e.priority-e.priority});for(var u=0,f=h.length;f>u;u++){var d,g=h[u].character,v=l[g].images[n.characters[u].mood],m=t.images[v],p=r.canvas.height-m.height;switch(h[u].position.toLowerCase()){case"left":d=r.canvas.width/4-m.width/2;break;case"right":d=r.canvas.width/4*3-m.width/2;break;case"middle":default:d=r.canvas.width/2-m.width/2}a.drawImage(m,d,p,m.width,m.height)}this.draw.dialogueBox(r,s,t.images.textbox);var x=this.text.CSS_string(s.font.size,s.font.family,s.font.style,s.font.weight);a.fillStyle=s.font.color,a.textBaseline="top",a.font=x;var w=(n.dialogue||"",r.canvas.width-(2*s.margin+2*s.padding),r.canvas.height-s.height-s.bottom+s.padding,s.margin+s.padding,n.dialogueLines.slice(n.startLine).slice(0,s.lines));this.draw.dialogueText(r,w,s,s.lines);var y=n.speaker||"",b=n.speakerColor||s.font.color;n.speaker in t.characters&&(y=t.characters[n.speaker].name,b=t.characters[n.speaker].color),this.draw.speakerText(r,y,s.speakerbox,b);var k=this;i(function(e){k.loop.call(k,e)})}}},function(e,t){"use strict";t.split=function(e,t,a,r,n,i){var o=e;if(n=n!==!1,i=i||[],-1!==t.indexOf("\n")){var s=t.indexOf("\n"),c=t.slice(0,s),l=t.slice(s+1);return this.split(e,c,a,r).concat(this.split(e,l,a,r))}if(o.measureText(t).width<=r)return[t];var h=t.split(" "),u=h.length;if(n){var f=r/(a/2.5),d=t.indexOf(" ",f);u=t.slice(0,d).split(" ").length,u>h.length&&(u=h.length)}for(var g=u;g>=1;g--){var c=h.slice(0,g).join(" "),l=h.slice(g,h.length).join(" "),v=o.measureText(c).width;if(n===!0&&r>v&&g===u)return this.split(e,t,a,r,!1);if(r>v)return i.push(c),l?i.concat(this.split(e,l,a,r)):i}return eVN.logger.warn('Unable to split word "'+h[0]+'".'),i.push(h.shift()),h.length>=1?i.concat(this.split(e,h.join(" "),a,r)):i},t.CSS_string=function(e,t,a,r){return e=e||18,t=t||"Comic Neue",a=a||"normal",r=r||"normal",t="'"===t[0]?t:'"'===t[0]?t:"'"+t+"'",a+" "+r+" "+e+"px "+t}},function(e,t){"use strict";t.background=function(e,t){var a=e,r=a;t instanceof Image?a.drawImage(t,0,0,r.canvas.width,r.canvas.height):(a.fillStyle=t,a.fillRect(0,0,r.canvas.width,r.canvas.height))},t.dialogueBox=function(e,t,a){var r=e,n=t;if(a){var i=0,o=r.canvas.height-a.height,s=a.width,c=a.height;r.drawImage(a,i,o,s,c)}else{var i=0,o=r.canvas.height-n.speakerbox.bottom-5,s=r.canvas.width,c=r.canvas.height;r.fillStyle="rgba(0, 0, 0, .35)",r.fillRect(i,o,s,c)}},t.speakerBox=function(e,t){var a=e,r=t,n=r.speakerbox,i=n.left,o=a.canvas.height-n.bottom-n.height,s=n.width,c=n.height;a.fillStyle=n.color||r.color,a.fillRect(i,o,s,c)},t.dialogueText=function(e,t,a,r){var n=e,i=a,o=i.lineHeight,s=i.maxWidth,c=i.left,l=n.canvas.height-i.bottom;r=r||3;for(var h=0,u=t.length;(u>r?r:u)>h;h++){var f=l+o*h;n.fillText(t[h],c,f,s)}},t.speakerText=function(e,t,a,r){var n=e,i=a,o=i.left,s=n.canvas.height-i.bottom,c=i.maxWidth||n.canvas.width-o;n.fillStyle=r||n.fillStyle,n.fillText(t,o,s,c)}},function(e,t){"use strict";e.exports={options:{textbox:{font:{size:"17",family:"Comic Neue",style:"normal",weight:"normal",color:"#EEE"},lines:3,lineHeight:"22",bottom:95,left:40,maxWidth:750,speakerbox:{left:25,bottom:130,maxWidth:150}}},audio:{},images:{},characters:{},scenes:{start:["No scenes defined!"]}}},function(e,t){"use strict";function a(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),i=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?"Unnamedlogger":arguments[0],a=arguments.length<=1||void 0===arguments[1]?"NaN":arguments[1],n=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];r(this,e),this.name=t,this.version=a,this.verbose=n,this.logName=this.name+" v"+this.version,this.logPrefix="["+this.logName+" INFO]",this.warnPrefix="["+this.logName+" WARN]",this.errPrefix="["+this.logName+" ERR]"}return n(e,[{key:"log",value:function(){for(var e,t=[this.logPrefix],r=arguments.length,n=Array(r),i=0;r>i;i++)n[i]=arguments[i];return n.length<1||!this.verbose?function(){}:(1===n.length&&"string"==typeof n[0]?t[0]+=" "+n[0]:t=[t[0]].concat(n),console&&console.log?(e=console.log).bind.apply(e,[console].concat(a(t))):void 0)}},{key:"warn",value:function(){for(var e,t=[this.warnPrefix],r=arguments.length,n=Array(r),i=0;r>i;i++)n[i]=arguments[i];return n.length<1?function(){}:(1===n.length&&"string"==typeof n[0]?t[0]+=" "+n[0]:t=[t[0]].concat(n),console&&console.warn?(e=console.warn).bind.apply(e,[console].concat(a(t))):void 0)}},{key:"throw",value:function(e,t){var a=this;void 0===e&&(e="UnknownError");var r;return e instanceof Error?r=e:(r=new Error(e),t&&(r.stack=t)),r.name=this.errPrefix+" "+r.name,function(){throw console&&console.error?(t&&console.error(a.errPrefix+" "+r.message),console.error(r.stack),a.logName+" halted"):r}}}]),e}();t.Logger=i}]);