!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){/**
	 * eVN - Everyone's Visual Novel (Development build)
	 * @see {@link https://github.com/bytesizedpacket/eVN}
	 * @fileOverview eVN core script
	 * @author Jacob Pedersen <jacob@bytesizedpacket.com> & Byte-Sized Packet <contact@bytesizedpacket.com>
	 * @copyright Byte-Sized Packet 2015
	 * @license {@link https://github.com/bytesizedpacket/eVN/blob/master/LICENSE | Attribution Assurance License (BSP edit)}
	 * @version: 0.0.1a Pre-development version */
"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(7),s=new o.Logger("eVN","0.1a",!0),c=function(){function e(){r(this,e),this.instances=[]}return a(e,[{key:"logger",get:function(){return s}}]),e}();t.Main=c,window.eVN?s["throw"]("`window.eVN` is already declared")():window.eVN=new c,document.addEventListener("DOMContentLoaded",function(){var e=Array.prototype.slice.call(document.getElementsByTagName("canvas")),t=!0,n=!1,r=void 0;try{for(var a,o=function(){var e=a.value;return(c=e.getAttribute("data-evn"))?(l=new XMLHttpRequest,l.open("GET",c,!0),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&new i.Novel(e,l.responseText,c)},void l.send()):{v:void 0}},s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var c,l,u=o();if("object"==typeof u)return u.v}}catch(h){n=!0,r=h}finally{try{!t&&s["return"]&&s["return"]()}finally{if(n)throw r}}}),setTimeout(function(){window.t=eVN.instances[0]},500)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(5),s=n(6),c=null,l={options:{textbox:{font:{size:17,family:"Comic Neue",style:"normal",weight:"normal",color:"#EEE"},lines:3,lineHeight:22,bottom:95,left:40,maxWidth:750,speakerbox:{left:25,bottom:130,maxWidth:150}}},audio:{},images:{},characters:{},scenes:{start:["No scenes defined"]}},u=function(){function e(t,n){var a=this,l=arguments.length<=2||void 0===arguments[2]?"undefined":arguments[2];r(this,e),c=eVN.logger,this.file=l,this.canvas=t,this.context=t.getContext("2d"),this.sceneInstructor=new s.SceneInstructor(this),this.sceneCmd=this.sceneInstructor.execute,this.images={},this.audio={},this.characters={},this.eVNML=this.parse_eVNML(n),this.visuals=new i.Visuals(this),this.cdata={background:null,characters:[],collection:"start",collectionIndex:0,dialogue:"",dialogueLines:[],mouseX:-1,mouseY:-1,jobs:[],startLine:0,speaker:""},this.canvas.className=this.canvas.className+" eVN-canvas",this.eVNML.options.textbox.image&&(this.images.textbox=new Image,this.images.textbox.src=this.eVNML.options.textbox.image),this.eVNML.options.textbox.speakerbox.image&&(this.images.speakerbox=new Image,this.images.speakerbox.src=this.eVNML.options.textbox.speakerbox.image),this.canvas.addEventListener("click",function(){return a.parseScene.call(a)}),this.canvas.addEventListener("mousemove",function(e){var t=e.target||e.srcElement,n=t.getBoundingClientRect(),r=n.width/t.width,i=n.height/t.height;a.cdata.mouseX=Math.round((e.clientX-n.left)/r),a.cdata.mouseY=Math.round((e.clientY-n.top)/i)});for(var u in this.eVNML.images)this.images[u]=new Image,this.images[u].src=this.eVNML.images[u];for(var u in this.eVNML.audio)this.audio[u]=new Audio,this.audio[u].src=this.eVNML.audio[u];for(var u in this.eVNML.characters)this.characters[u]=new o.Character(this.eVNML.characters[u]);this.parseScene(this.cdata.currentCollection,this.cdata.collectionIndex);var h=eVN.instances.push(this)-1;c.log("Created new eVN instance from file `"+this.file+"` under eVN.instances["+h+"]")()}return a(e,[{key:"parse_eVNML",value:function(e){var t=e,n=l;try{t=JSON.parse(e);var r=function i(e,t){var n=t;for(var r in e)r in t?e[r].constructor===Object&&t[r].constructor===Object?n[r]=i(e[r],t[r]):e[r].constructor!==t[r].constructor?(eVN.logger.warn('Possible type mismatch on property "'+r+'" while parsing eVNML.'),n[r]=e[r]):n[r]=e[r]:n[r]=e[r];return n};n=r(t,l)}catch(a){eVN.logger["throw"](a)}return n}},{key:"parseScene",value:function(e,t){var n=this.cdata,r=this.eVNML,a=r.options.textbox;if(e=e||n.collection,t="undefined"!=typeof t?t:n.collectionIndex,n.startLine+a.lines<n.dialogueLines.length)return n.startLine+=a.lines;var i=this.eVNML.scenes[e][t];if(n.collection=e,n.collectionIndex=t+1,i||eVN.logger["throw"]('Undefined scene "'+e+"["+t+']"! Did we run out of scenes?')(),n.speakerColor=null,"string"==typeof i){var o=i.indexOf(": "),s=i.slice(0,o),l=i.slice(o+2),u=o<i.indexOf(" ")&&s in this.characters;i=u?["say",l,s]:["say",i]}var h=this.sceneInstructor.getMethod(i[0].toLowerCase(),i.slice(1));if(null!==h){var f=h()||!1;if(f)return}else c.warn('Unknown command "'+i[0]+'" at "'+e+"["+t+']"')();this.parseScene()}},{key:"processVariables",value:function(e){var t=e.indexOf("${"),n=e.indexOf("}",t),r="";if(-1!==t&&-1!==n){var a=e.slice(0,t),i=e.slice(t+2,n),o=e.slice(n+1);r=i;var s=i.split(".");this.cdata.characters.map(function(e){return e.character}).indexOf(s[0]);return s[0]in this.characters&&(r=this.characters[s[0]][s[1]]),r=a+r+o,-1!==r.indexOf("${")?this.processVariables(r):r}return e}}]),e}();t.Novel=u},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),s=r(o),c=n(4),l=r(c),u=null,h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},f=function(){function e(t){var n=this;a(this,e),u=eVN.logger,this.novel=t,this.ctx=t.context,this.draw=l,this.text=s,h(function(e){return n.loop(e)})}return i(e,[{key:"loop",value:function(e){var t=this,n=this.novel,r=n.context,a=n.cdata,i=n.eVNML.options.textbox,o=a.background,s=null,c=n.characters;o?"#"===o[0]?s=o:o in n.images&&(s=n.images[o]):s=null,this.draw.background(r,s||"#FFF"),n.cdata.characters.sort(function(e,t){return e.priority-t.priority});var l=!0,u=!1,f=void 0;try{for(var d,g=a.characters[Symbol.iterator]();!(l=(d=g.next()).done);l=!0){var v=d.value,m=v.character,p=c[m].images[v.mood],y=n.images[p],b=null,w=r.canvas.height-y.height;switch(v.position.toLowerCase()){case"left":b=r.canvas.width/4-y.width/2;break;case"right":b=r.canvas.width/4*3-y.width/2;break;case"middle":default:b=r.canvas.width/2-y.width/2}r.drawImage(y,b,w,y.width,y.height)}}catch(x){u=!0,f=x}finally{try{!l&&g["return"]&&g["return"]()}finally{if(u)throw f}}this.draw.dialogueBox(r,i,n.images.textbox);var k=this.text.CSS_string(i.font.size,i.font.family,i.font.style,i.font.weight);r.fillStyle=i.font.color,r.textBaseline="top",r.font=k;var N=(a.dialogue||"",a.dialogueLines.slice(a.startLine).slice(0,i.lines));this.draw.dialogueText(r,N,i,i.lines);var V=a.speaker||"",L=a.speakerColor||i.font.color;a.speaker in n.characters&&(V=n.characters[a.speaker].name,L=n.characters[a.speaker].color),this.draw.speakerText(r,V,i.speakerbox,L),h(function(e){return t.loop(e)})}}]),e}();t.Visuals=f},function(e,t){"use strict";function n(e,t,n,r){var a=arguments.length<=4||void 0===arguments[4]?!0:arguments[4],i=arguments.length<=5||void 0===arguments[5]?[]:arguments[5];if(a=a!==!1,-1!==t.indexOf("\n")){var o=t.indexOf("\n"),s=t.slice(0,o),c=t.slice(o+1);return this.split(e,s,n,r).concat(this.split(e,c,n,r))}if(e.measureText(t).width<=r)return[t];var l=t.split(" "),u=l.length;if(a){var h=r/(n/2.5),f=t.indexOf(" ",h);u=t.slice(0,f).split(" ").length,u>l.length&&(u=l.length)}for(var d=u;d>=1;d--){var s=l.slice(0,d).join(" "),c=l.slice(d,l.length).join(" "),g=e.measureText(s).width;if(a&&r>g&&d===u)return this.split(e,t,n,r,!1);if(r>g)return i.push(s),c?i.concat(this.split(e,c,n,r)):i}return eVN.logger.warn('Unable to split word "'+l[0]+'".')(),i.push(l.shift()),l.length>=1?i.concat(this.split(e,l.join(" "),n,r)):i}function r(){var e=arguments.length<=0||void 0===arguments[0]?18:arguments[0],t=arguments.length<=1||void 0===arguments[1]?"Comic Neue":arguments[1],n=arguments.length<=2||void 0===arguments[2]?"normal":arguments[2],r=arguments.length<=3||void 0===arguments[3]?"normal":arguments[3];return t="'"===t[0]?t:'"'===t[0]?t:"'"+t+"'",n+" "+r+" "+e+"px "+t}Object.defineProperty(t,"__esModule",{value:!0}),t.split=n,t.CSS_string=r},function(e,t){"use strict";function n(e,t){t instanceof Image?e.drawImage(t,0,0,e.canvas.width,e.canvas.height):(e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height))}function r(e,t,n){if(n){var r=0,a=e.canvas.height-n.height,i=n.width,o=n.height;e.drawImage(n,r,a,i,o)}else{var r=0,a=e.canvas.height-t.speakerbox.bottom-5,i=e.canvas.width,o=e.canvas.height;e.fillStyle="rgba(0, 0, 0, .35)",e.fillRect(r,a,i,o)}}function a(e,t){var n=t.speakerbox,r=t.left,a=e.canvas.height-n.bottom-n.height,i=n.width,o=speakerboxOptionsbox.height;e.fillStyle=speakerboxOptionsbox.color||t.color,e.fillRect(r,a,i,o)}function i(e,t,n,r){var a=n,i=a.lineHeight,o=a.maxWidth,s=a.left,c=e.canvas.height-a.bottom;r=r||3;for(var l=0,u=t.length;(u>r?r:u)>l;l++){var h=c+i*l;e.fillText(t[l],s,h,o)}}function o(e,t,n,r){var a=n,i=a.left,o=e.canvas.height-a.bottom,s=a.maxWidth||e.canvas.width-i;e.fillStyle=r||e.fillStyle,e.fillText(t,i,o,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.background=n,t.dialogueBox=r,t.speakerBox=a,t.dialogueText=i,t.speakerText=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){n(this,e),this.name=t["first name"]||t.name,this.lname=t["last name"]||null,this.color=t.color||t.colour||"#FFF",this.images=t.images||{},this.mood="default"}return r(e,[{key:"cImage",get:function(){return this.images[this.mood]}}]),e}();t.Character=a},function(e,t){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e),this.scope=t,this["goto"]=this.jump}return a(e,[{key:"getMethod",value:function(e,t){var r=this[e];return r instanceof Function?r.bind.apply(r,[this.scope].concat(n(t))):null}},{key:"background",value:function(e){return this.cdata.background=e,!1}},{key:"music",value:function(e){return e in this.audio&&this.audio[e].play(),!1}},{key:"say",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?"#FFF":arguments[2],r=this.cdata,a=this.eVNML.options.textbox;e=this.processVariables(e),null!==t?(r.speaker=t,r.dialogue='"'+e+'"',r.speakerColor=n):r.dialogue=e;var i=a.maxWidth;return r.dialogueLines=this.visuals.text.split(this.context,r.dialogue,a.font.size,i),r.startLine=0,!0}},{key:"setmood",value:function(e,t){var n=-1,r=!0,a=!1,o=void 0;try{for(var s,c=this.cdata.characters[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var l=s.value;if(l.character===e){n=i;break}}}catch(u){a=!0,o=u}finally{try{!r&&c["return"]&&c["return"]()}finally{if(a)throw o}}return n>-1&&(this.cdata.characters[n].mood=t||"default"),!0}},{key:"hide",value:function(e){return this.cdata.characters[e]=null,!1}},{key:"show",value:function(e,t,n,r){var a=-1,o=!0,s=!1,c=void 0;try{for(var l,u=this.cdata.characters[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var h=l.value;if(h.character===e){a=i;break}}}catch(f){s=!0,c=f}finally{try{!o&&u["return"]&&u["return"]()}finally{if(s)throw c}}if(a>-1){var d=this.cdata.characters[a];d={character:d.character,position:t||d.position||"middle",mood:d.mood||"default",priority:r||d.priority||1}}else this.cdata.characters.push({character:e,position:t||"middle",mood:"default"})}},{key:"jump",value:function(e){return this.cdata.collection=e,this.cdata.collectionIndex=0,!1}}]),e}();t.SceneInstructor=o},function(e,t){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?"Unnamedlogger":arguments[0],n=arguments.length<=1||void 0===arguments[1]?"NaN":arguments[1],a=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];r(this,e),this.name=t,this.version=n,this.verbose=a,this.logName=this.name+" v"+this.version,this.logPrefix="["+this.logName+" INFO]",this.warnPrefix="["+this.logName+" WARN]",this.errPrefix="["+this.logName+" ERR]"}return a(e,[{key:"log",value:function(){for(var e,t=[this.logPrefix],r=arguments.length,a=Array(r),i=0;r>i;i++)a[i]=arguments[i];return a.length<1||!this.verbose?function(){}:(1===a.length&&"string"==typeof a[0]?t[0]+=" "+a[0]:t=[t[0]].concat(a),console&&console.log?(e=console.log).bind.apply(e,[console].concat(n(t))):void 0)}},{key:"warn",value:function(){for(var e,t=[this.warnPrefix],r=arguments.length,a=Array(r),i=0;r>i;i++)a[i]=arguments[i];return a.length<1?function(){}:(1===a.length&&"string"==typeof a[0]?t[0]+=" "+a[0]:t=[t[0]].concat(a),console&&console.warn?(e=console.warn).bind.apply(e,[console].concat(n(t))):void 0)}},{key:"throw",value:function(e,t){var n=this;void 0===e&&(e="UnknownError");var r;return e instanceof Error?r=e:(r=new Error(e),t&&(r.stack=t)),r.name=this.errPrefix+" "+r.name,function(){throw console&&console.error?(t&&console.error(n.errPrefix+" "+r.message),console.error(r.stack),n.logName+" halted"):r}}}]),e}();t.Logger=i}]);