!function(e){function t(a){if(r[a])return r[a].exports;var n=r[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){/**eVN - Everyone's Visual Novel (Development build)
	 * @see {@link https://github.com/bytesizedpacket/eVN}
	 * @fileOverview eVN core script
	 * @author Jacob Pedersen <jacob@bytesizedpacket.com> & Byte-Sized Packet <contact@bytesizedpacket.com>
	 * @copyright Byte-Sized Packet 2015
	 * @license {@link https://github.com/bytesizedpacket/eVN/blob/master/LICENSE | Attribution Assurance License (BSP edit)}
	 * @version: 0.0.1a Pre-development version */
"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),i=r(1),o=r(6),s=new o.Logger("eVN","0.1a",!0),c=function(){function e(){a(this,e),this.instances=[]}return n(e,[{key:"logger",get:function(){return s}}]),e}();t.Main=c,window.eVN?s["throw"]("`window.eVN` is already declared")():window.eVN=new c,document.addEventListener("DOMContentLoaded",function(){var e=Array.prototype.slice.call(document.getElementsByTagName("canvas")),t=!0,r=!1,a=void 0;try{for(var n,o=function(){var e=n.value;return(c=e.getAttribute("data-evn"))?(l=new XMLHttpRequest,l.open("GET",c,!0),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&new i.Novel(e,l.responseText,c)},void l.send()):{v:void 0}},s=e[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var c,l,u=o();if("object"==typeof u)return u.v}}catch(h){r=!0,a=h}finally{try{!t&&s["return"]&&s["return"]()}finally{if(r)throw a}}}),setTimeout(function(){window.t=eVN.instances[0]},500)},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=r(2),s=null,c=function(){function e(t,r){var n=this,i=arguments.length<=2||void 0===arguments[2]?"undefined":arguments[2];a(this,e),s=eVN.logger,this.file=i,this.canvas=t,this.context=t.getContext("2d"),this.images={},this.audio={},this.characters={},this.eVNML=this.parse_eVNML(r),this.visuals=new o.Visuals(this),this.cdata={background:null,characters:[],collection:"start",collectionIndex:0,dialogue:"",dialogueLines:[],mouseX:-1,mouseY:-1,jobs:[],startLine:0,speaker:""},this.canvas.className=this.canvas.className+" eVN-canvas",this.eVNML.options.textbox.image&&(this.images.textbox=new Image,this.images.textbox.src=this.eVNML.options.textbox.image),this.eVNML.options.textbox.speakerbox.image&&(this.images.speakerbox=new Image,this.images.speakerbox.src=this.eVNML.options.textbox.speakerbox.image),this.canvas.addEventListener("click",function(){return n.parseScene.call(n)}),this.canvas.addEventListener("mousemove",function(e){var t=e.target||e.srcElement,r=t.getBoundingClientRect(),a=r.width/t.width,i=r.height/t.height;n.cdata.mouseX=Math.round((e.clientX-r.left)/a),n.cdata.mouseY=Math.round((e.clientY-r.top)/i)});for(var c in this.eVNML.images)this.images[c]=new Image,this.images[c].src=this.eVNML.images[c];for(var c in this.eVNML.audio)this.audio[c]=new Audio,this.audio[c].src=this.eVNML.audio[c];for(var c in this.eVNML.characters){var l=this.eVNML.characters[c];this.characters[c]={name:l["first name"]||l.name,lname:l["last name"],color:l.color||l.colour,images:{}};var u=this.characters[c];for(var h in l.images)u.images[h]=l.images[h];u.cImage=u.images["default"]}this.parseScene(this.cdata.currentCollection,this.cdata.collectionIndex);var f=eVN.instances.push(this)-1;s.log("Created new eVN instance from file `"+this.file+"` under eVN.instances["+f+"]")()}return n(e,[{key:"parse_eVNML",value:function(e){var t=r(5),a=e,n=t;try{a=JSON.parse(e);var i=function s(e,t){var r=t;for(var a in e)a in t?e[a].constructor===Object&&t[a].constructor===Object?r[a]=s(e[a],t[a]):e[a].constructor!==t[a].constructor?(eVN.logger.warn('Possible type mismatch on property "'+a+'" while parsing eVNML.'),r[a]=e[a]):r[a]=e[a]:r[a]=e[a];return r};n=i(a,t)}catch(o){eVN.logger["throw"](o)}return n}},{key:"parseScene",value:function(e,t){var r=this.cdata,a=this.eVNML,n=a.options.textbox;if(e=e||r.collection,t="undefined"!=typeof t?t:r.collectionIndex,r.startLine+n.lines<r.dialogueLines.length)return r.startLine+=n.lines;var o=this.eVNML.scenes[e][t];if(r.collection=e,r.collectionIndex=t+1,o||eVN.logger["throw"]('Undefined scene "'+e+"["+t+']"! Did we run out of scenes?'),r.speakerColor=null,"string"==typeof o){var s=o.indexOf(": "),c=o.slice(0,s),l=o.slice(s+2),u=s<o.indexOf(" ")&&c in this.characters;o=u?["say",l,c]:["say",o]}switch(o[0].toLowerCase()){case"background":r.background=o[1];break;case"music":o[1]in this.audio&&this.audio[o[1]].play();break;case"say":var h=this.processVariables(o[1]);o[2]?(r.speaker=o[2],r.dialogue='"'+h+'"',r.speakerColor=o[3]||null):(r.speaker=null,r.dialogue=h);var f=n.maxWidth;return r.dialogueLines=this.visuals.text.split(this.context,r.dialogue,n.font.size,f),void(r.startLine=0);case"setmood":var d=-1,g=!0,v=!1,m=void 0;try{for(var p,w=r.characters[Symbol.iterator]();!(g=(p=w.next()).done);g=!0){var x=p.value;if(x.character===o[1]){d=i;break}}}catch(b){v=!0,m=b}finally{try{!g&&w["return"]&&w["return"]()}finally{if(v)throw m}}d>-1&&(r.characters[d].mood=o[2]||"default");break;case"hide":r.characters[o[1]]=null;break;case"show":var d=-1,y=!0,k=!1,N=void 0;try{for(var V,L=r.characters[Symbol.iterator]();!(y=(V=L.next()).done);y=!0){var x=V.value;if(x.character===o[1]){d=i;break}}}catch(b){k=!0,N=b}finally{try{!y&&L["return"]&&L["return"]()}finally{if(k)throw N}}if(d>-1){var M=r.characters[d];M={character:M.character,position:o[2]||M.position||"middle",mood:M.mood||"default",priority:o[4]||M.priority||1}}else r.characters.push({character:o[1],position:o[2]||"middle",mood:"default"});break;case"goto":case"jump":r.collection=o[1],r.collectionIndex=0;break;default:eVN.logger.warn('Unknown command "'+o[0]+'" at "'+e+"["+t+']"')}this.parseScene()}},{key:"processVariables",value:function(e){var t=e.indexOf("${"),r=e.indexOf("}",t),a="";if(-1!==t&&-1!==r){var n=e.slice(0,t),i=e.slice(t+2,r),o=e.slice(r+1);a=i;var s=i.split(".");this.cdata.characters.map(function(e){return e.character}).indexOf(s[0]);return s[0]in this.characters&&(a=this.characters[s[0]][s[1]]),a=n+a+o,-1!==a.indexOf("${")?this.processVariables(a):a}return e}},{key:"constructCharacter",value:function(e){var t=e.name;this.characters[t]={}}}]),e}();t.Novel=c},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),i=null,o=r(3),s=r(4),c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},l=function(){function e(t){var r=this;a(this,e),i=eVN.logger,this.novel=t,this.ctx=t.context,this.draw=s,this.text=o,c(function(e){return r.loop(e)})}return n(e,[{key:"loop",value:function(e){var t=this.novel,r=t.context,a=r,n=t.cdata,i=t.eVNML,o=i.options.textbox,s=n.background,l=t.characters,u=t.cdata.characters;s&&"#"!==s[0]&&s in t.images&&(s=t.images[s]),this.draw.background(a,s||"#FFF"),u.sort(function(e,t){return e.priority-e.priority});for(var h=0,f=u.length;f>h;h++){var d,g=u[h].character,v=l[g].images[n.characters[h].mood],m=t.images[v],p=a.canvas.height-m.height;switch(u[h].position.toLowerCase()){case"left":d=a.canvas.width/4-m.width/2;break;case"right":d=a.canvas.width/4*3-m.width/2;break;case"middle":default:d=a.canvas.width/2-m.width/2}r.drawImage(m,d,p,m.width,m.height)}this.draw.dialogueBox(a,o,t.images.textbox);var w=this.text.CSS_string(o.font.size,o.font.family,o.font.style,o.font.weight);r.fillStyle=o.font.color,r.textBaseline="top",r.font=w;var x=(n.dialogue||"",a.canvas.width-(2*o.margin+2*o.padding),a.canvas.height-o.height-o.bottom+o.padding,o.margin+o.padding,n.dialogueLines.slice(n.startLine).slice(0,o.lines));this.draw.dialogueText(a,x,o,o.lines);var b=n.speaker||"",y=n.speakerColor||o.font.color;n.speaker in t.characters&&(b=t.characters[n.speaker].name,y=t.characters[n.speaker].color),this.draw.speakerText(a,b,o.speakerbox,y);var k=this;c(function(e){k.loop.call(k,e)})}}]),e}();t.Visuals=l},function(e,t){"use strict";t.split=function(e,t,r,a,n,i){var o=e;if(n=n!==!1,i=i||[],-1!==t.indexOf("\n")){var s=t.indexOf("\n"),c=t.slice(0,s),l=t.slice(s+1);return this.split(e,c,r,a).concat(this.split(e,l,r,a))}if(o.measureText(t).width<=a)return[t];var u=t.split(" "),h=u.length;if(n){var f=a/(r/2.5),d=t.indexOf(" ",f);h=t.slice(0,d).split(" ").length,h>u.length&&(h=u.length)}for(var g=h;g>=1;g--){var c=u.slice(0,g).join(" "),l=u.slice(g,u.length).join(" "),v=o.measureText(c).width;if(n===!0&&a>v&&g===h)return this.split(e,t,r,a,!1);if(a>v)return i.push(c),l?i.concat(this.split(e,l,r,a)):i}return eVN.logger.warn('Unable to split word "'+u[0]+'".'),i.push(u.shift()),u.length>=1?i.concat(this.split(e,u.join(" "),r,a)):i},t.CSS_string=function(e,t,r,a){return e=e||18,t=t||"Comic Neue",r=r||"normal",a=a||"normal",t="'"===t[0]?t:'"'===t[0]?t:"'"+t+"'",r+" "+a+" "+e+"px "+t}},function(e,t){"use strict";t.background=function(e,t){var r=e,a=r;t instanceof Image?r.drawImage(t,0,0,a.canvas.width,a.canvas.height):(r.fillStyle=t,r.fillRect(0,0,a.canvas.width,a.canvas.height))},t.dialogueBox=function(e,t,r){var a=e,n=t;if(r){var i=0,o=a.canvas.height-r.height,s=r.width,c=r.height;a.drawImage(r,i,o,s,c)}else{var i=0,o=a.canvas.height-n.speakerbox.bottom-5,s=a.canvas.width,c=a.canvas.height;a.fillStyle="rgba(0, 0, 0, .35)",a.fillRect(i,o,s,c)}},t.speakerBox=function(e,t){var r=e,a=t,n=a.speakerbox,i=n.left,o=r.canvas.height-n.bottom-n.height,s=n.width,c=n.height;r.fillStyle=n.color||a.color,r.fillRect(i,o,s,c)},t.dialogueText=function(e,t,r,a){var n=e,i=r,o=i.lineHeight,s=i.maxWidth,c=i.left,l=n.canvas.height-i.bottom;a=a||3;for(var u=0,h=t.length;(h>a?a:h)>u;u++){var f=l+o*u;n.fillText(t[u],c,f,s)}},t.speakerText=function(e,t,r,a){var n=e,i=r,o=i.left,s=n.canvas.height-i.bottom,c=i.maxWidth||n.canvas.width-o;n.fillStyle=a||n.fillStyle,n.fillText(t,o,s,c)}},function(e,t){"use strict";e.exports={options:{textbox:{font:{size:"17",family:"Comic Neue",style:"normal",weight:"normal",color:"#EEE"},lines:3,lineHeight:"22",bottom:95,left:40,maxWidth:750,speakerbox:{left:25,bottom:130,maxWidth:150}}},audio:{},images:{},characters:{},scenes:{start:["No scenes defined!"]}}},function(e,t){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),i=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?"Unnamedlogger":arguments[0],r=arguments.length<=1||void 0===arguments[1]?"NaN":arguments[1],n=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];a(this,e),this.name=t,this.version=r,this.verbose=n,this.logName=this.name+" v"+this.version,this.logPrefix="["+this.logName+" INFO]",this.warnPrefix="["+this.logName+" WARN]",this.errPrefix="["+this.logName+" ERR]"}return n(e,[{key:"log",value:function(){for(var e,t=[this.logPrefix],a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];return n.length<1||!this.verbose?function(){}:(1===n.length&&"string"==typeof n[0]?t[0]+=" "+n[0]:t=[t[0]].concat(n),console&&console.log?(e=console.log).bind.apply(e,[console].concat(r(t))):void 0)}},{key:"warn",value:function(){for(var e,t=[this.warnPrefix],a=arguments.length,n=Array(a),i=0;a>i;i++)n[i]=arguments[i];return n.length<1?function(){}:(1===n.length&&"string"==typeof n[0]?t[0]+=" "+n[0]:t=[t[0]].concat(n),console&&console.warn?(e=console.warn).bind.apply(e,[console].concat(r(t))):void 0)}},{key:"throw",value:function(e,t){var r=this;void 0===e&&(e="UnknownError");var a;return e instanceof Error?a=e:(a=new Error(e),t&&(a.stack=t)),a.name=this.errPrefix+" "+a.name,function(){throw console&&console.error?(t&&console.error(r.errPrefix+" "+a.message),console.error(a.stack),r.logName+" halted"):a}}}]),e}();t.Logger=i}]);